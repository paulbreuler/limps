# Run lint-staged in packages/limps to auto-fix formatting and linting on staged files
cd packages/limps && npx lint-staged

# Stage any auto-fixed files from lint-staged before running full checks
git add -u

# Regenerate skills manifest if skills or related files changed
if git diff --cached --name-only | grep -Eq '(^|/)\.claude/skills/|^scripts/generate-skills-manifest\.js$|^skills(-limps)?\.yaml$'; then
  cd "$(git rev-parse --show-toplevel)"
  npm run skills:manifest
  git add skills.yaml skills-limps.yaml
fi

# Run validation from root (format check, lint, type-check, build across workspaces)
# Tests are intentionally skipped to avoid flaky pre-commit failures.
cd "$(git rev-parse --show-toplevel)" && npm run format:check && npm run lint && npm run type-check && npm run build
